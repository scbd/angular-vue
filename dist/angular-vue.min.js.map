{"version":3,"file":"angular-vue.min.js","sources":["../src/libs/paths.js","../src/directives/vue.js","../src/index.js"],"sourcesContent":["export default {\n  parent,\n  parents,\n  leaf,\n  root,\n  isRoot,\n};\n\nfunction parent(path) {\n  const parts = split(path);\n\n  parts.pop();\n\n  return combine(parts);\n}\n\nfunction parents(path) {\n  const parentPaths = [];\n\n  let parentPath = parent(path);\n\n  while (parentPath) {\n    parentPaths.push(parentPath);\n    parentPath = parent(parentPath);\n  }\n\n  return parentPaths;\n}\n\nfunction leaf(path) {\n  const parts = split(path);\n  return parts.pop();\n}\n\nfunction root(path) {\n  return split(path)[0];\n}\n\nfunction isRoot(path) {\n  return split(path).length === 1;\n}\n\nfunction split(path) {\n  if (!path) throw new Error(`Invalid path ${path}`);\n\n  return path.split('.');\n}\n\nfunction combine(parts) {\n  return parts.join('.');\n}\n","import _ from 'lodash';\nimport Vue from 'Vue';\nimport paths from '../libs/paths';\n\nexport default { register };\n\nfunction register(ngModule) {\n  ngModule.directive('vue', [ function () {\n    return {\n      restrict: 'A',\n      terminal: true, // any directive with lower priority will be ignored\n      priority: 1001, // 1 more than ngNonBindable => disable angular interpolation!\n      link(scope, element, attrs) {\n        const ngDelegates             = loadExposedDelegates(attrs);\n        const ngProperties            = loadExposedProperties(attrs);\n        const syncedPropertiesMapping = loadSyncedPropertiesMapping(attrs);\n\n        // test declarations\n\n        ngProperties.forEach((prop) => testDefined(scope, prop));\n        ngDelegates.forEach((prop) => testDefined(scope, prop));\n\n        const vueData    = {};\n        const vueMethods = {};\n\n        ngProperties.filter(paths.isRoot).forEach((ngProp) => {\n          const vueProp    = ngProp;\n          vueData[vueProp] = scope.$eval(ngProp); // set initial value\n        });\n\n        ngDelegates.forEach((ngDelegate) => {\n          vueMethods[ngDelegate] = (...args) => {\n            console.log(`Calling ng delegate: ${ngDelegate}()`);\n            scope.$apply(() => scope.$eval(ngDelegate).apply(scope, args));\n          };\n        });\n\n        // Create root component;\n\n        const vm = new Vue({\n          components: scope.$vueComponents,\n          data      : vueData,\n          methods   : vueMethods,\n        }).$mount(element[0]);\n\n        // Watch changes\n\n        ngProperties.forEach((ngProp) => {\n          const vueProp = ngProp;\n\n          scope.$watch(ngProp, (value) => {\n            console.log(`ng(${ngProp}) => vue(${vueProp}) =`, value);\n\n            let target = vm;\n            let prop   = vueProp;\n\n            if (!paths.isRoot(prop)) {\n              target = _.get(vm, paths.parent(prop));\n              prop   = paths.leaf(prop);\n            }\n\n            Vue.set(target, prop, value);\n          });\n        });\n\n        _.forEach(syncedPropertiesMapping, (ngProp, vueProp) => { // .sync\n          vm.$children.forEach((c) => c.$on(`update:${vueProp}`, (value) => {\n            console.log(`vue(${vueProp}) => ng(${ngProp}) =`, value);\n            scope.$apply(() => _.set(scope, ngProp, value));\n          }));\n        });\n      },\n    };\n\n    function loadExposedProperties(attrs) {\n      const vDirectives = /^(?:v-model|v-html|v-text|v-show|v-class|v-attr|v-style|v-if)(?:\\.[a-z0-9]+)*$/i;\n      const vBind       = /^(?:v-bind)?:[a-z-]+(\\.[a-z]+)*$/i;\n      const vBindValue  = /^[a-z$_][a-z0-9$_]*(\\.[a-z$_][a-z0-9$_]*)*$/i;\n\n      const properties = (attrs.vueExpose ?? '').split(',').map((o) => o.trim()).filter((o) => vBindValue.test(o));\n\n      // autodetect simple binding on props detect\n\n      const attributes = remapAttributes(attrs);\n\n      _.forEach(attributes, (value, name) => {\n        const validName =  vBind.test(name)\n                            || vDirectives.test(name);\n\n        if (validName && vBindValue.test(value)) {\n          properties.push(value);\n        }\n      });\n\n      // Add parent properties\n\n      let allProperties = [ ...properties ];\n\n      properties.forEach((prop) => {\n        allProperties =  _.union(allProperties, paths.parents(prop));\n      });\n\n      return _(allProperties).uniq().sort().value();\n    }\n\n    function loadSyncedPropertiesMapping(attrs) {\n      // autodetect simple binding on props detect\n\n      const vModel     = /^(?:v-model)$/i;\n      const vBind      = /^(?:v-bind)?:([a-z-]+)\\.sync*$/i;\n      const vBindValue = /^[a-z$_][a-z0-9$_]*(\\.[a-z$_][a-z0-9$_]*)*$/i;\n\n      const mapping    = {};\n      const attributes = remapAttributes(attrs);\n\n      _.forEach(attributes, (value, name) => {\n        if (vModel.test(name)) {\n          const vueProp = 'value';\n\n          if (!vBindValue.test(value)) throw Error(`Unsupported v-model binding value: ${value}`);\n\n          mapping[vueProp] = value;\n        }\n\n        if (vBind.test(name)) {\n          const vueProp = name.replace(vBind, '$1') // Keep only property name\n            .replace(/-[a-z]/g, (m) => m[1].toUpperCase()).replace(/^[A-Z]/, (m) => m[1].toLowerCase()); // convert to camel-case\n\n          if (!vBindValue.test(value)) throw Error(`Unsupported v-bind:${vueProp}.sync binding value: ${value}`);\n\n          mapping[vueProp] = value;\n        }\n      });\n\n      return mapping;\n    }\n\n    function loadExposedDelegates(attrs) {\n      const ngVueDeclaredRe = /^&([a-z$_][a-z0-9$_]*)$/i;\n      const ngDelegates     = (attrs.vueExpose ?? '')\n        .split(',')\n        .map((o) => o.trim())\n        .filter((o) => ngVueDeclaredRe.test(o))\n        .map((o) => o.replace(ngVueDeclaredRe, '$1'));\n\n      // autodetect simple delegate call with empty ()\n      // eg: call_function()\n\n      const vOnRe         = /^(?:v-on:|@)[a-z-]+(:[a-z0-9-]+)?(\\.[a-z0-9-]+)*/i;\n      const vOnDelegateRe = /^([a-z_$][a-z0-9_$]*)(?:\\(\\))?$/i;\n\n      const attributes = remapAttributes(attrs);\n\n      _.forEach(attributes, (value, name) => {\n        const validName = vOnRe.test(name);\n\n        if (validName && vOnDelegateRe.test(value)) {\n          ngDelegates.push(value.replace(vOnDelegateRe, '$1'));\n        }\n      });\n\n      return ngDelegates;\n    }\n\n    function remapAttributes(attrs) {\n      const attributes = {};\n\n      _.forEach(attrs.$attr, (name, key) => {\n        const value      = attrs[key];\n        attributes[name] = value;\n      });\n\n      return attributes;\n    }\n\n    function testDefined(scope, expression) {\n      if (scope.$eval(expression) === undefined) {\n        throw Error(`\"${expression}\" is not defined on parent scope`);\n      }\n    }\n  } ]);\n}\n","import angular from 'angular';\nimport vueDirective from './directives/vue';\n\nconst ngModule = angular.module('angularVue', []);\n\nvueDirective.register(ngModule);\n"],"names":["parent","parents","path","parentPaths","parentPath","push","leaf","split","pop","root","isRoot","length","parts","join","combine","Error","register","ngModule","directive","restrict","terminal","priority","link","scope","element","attrs","ngDelegates","ngVueDeclaredRe","vueExpose","map","o","trim","filter","test","replace","vOnRe","vOnDelegateRe","attributes","remapAttributes","_","forEach","value","name","loadExposedDelegates","ngProperties","vDirectives","vBind","vBindValue","properties","allProperties","prop","union","paths","uniq","sort","loadExposedProperties","syncedPropertiesMapping","vModel","mapping","vueProp","m","toUpperCase","toLowerCase","loadSyncedPropertiesMapping","testDefined","vueData","vueMethods","ngProp","$eval","ngDelegate","args","console","log","$apply","apply","vm","Vue","components","$vueComponents","data","methods","$mount","$watch","target","get","set","$children","c","$on","$attr","key","expression","undefined","angular","module","vueDirective"],"mappings":"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"}