<!doctype html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular-route.min.js"></script>
    <script type="importmap">
    { "imports": {
        "vue"     : "https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.esm-browser.js"
    } }
  </script>
</head>
  <body >
    <div>
        <div ng-controller="MyNgController">
            <h1>Vue into AngularJS (Current Vue version: {{vueVersion}})</h1>

                <div class="ng-box">

                    <input ng-model="ngMessage"> {{ngMessage}}

                    <div class="vue-box" ng-vue v-model:click-count="clickCount">
                        Current route: {{$route}}
                        <button type="button" @click="$router.push({ path: `/updated/${++clickCount}`})">Update route</button>
                    </div>

                    <div class="vue-box" ng-vue ng-vue-debug :message.sync="ngMessage" >
                        message.sync <input v-model="message"> {{message}} (.sync should warn in console )
                    </div>

                    <div class="vue-box" ng-vue v-model:message="ngMessage" >
                        v-model:message <input v-model="message"> {{message}} 
                    </div>
                    <div class="vue-box" ng-vue :message="ngMessage" >
                        message
                        <input v-model="message"> {{message}} (one-way should throw exception)
                    </div>
                    <div class="vue-box" ng-vue :message.sync="ngMessage" >
                        <input v-model="message"> {{message}}

                        <span v-if="message">
                        <vue-ng  :ng-Value="message">
                            <div class="ng-box"  v-pre>
                                this code run in angular!
                                The value passed to Angular is {{ngValue}}
                            </div>
                        </vue-ng>
                        </span>
                    </div>

                    <h3>using v-model</h3>
                    <test-vue3 class="vue-box" ng-vue="{ components }" v-model="ngMessage" @message="alert($event)"></test-vue3>

                    <h3>using :modelValue/update:modelValue</h3>
                    <test-vue3 class="vue-box" ng-vue="{ components }" :model-value="ngMessage" @update:model-value="ngMessage = $event" @message="alert($event)"></test-vue3>

                    <h2>contact</h2>
                    <div ng-Repeat="ctc in ngContacts">
                        <div class="vue-box" ng-vue :index="$index" :first-name.sync="ctc.firstName" :last-name.sync="ctc.lastName" >
                            {{index}} {{firstName}} {{lastName}}<br>
                            <input v-model="firstName">
                            <input v-model="lastName">
                        </div>
                    </div>
                    <div class="vue-box" ng-vue :first-name-1.sync="ngContacts[0].firstName" :first-name-2.sync="ngContacts[1].firstName" >
                        [0]<input v-model="firstName1"> + 
                        [1]<input v-model="firstName2"> = 
                        <span v-if="`${firstName1} ${firstName2}`=='febina blaise'">‚ù§Ô∏è</span>
                        <span v-else-if="`${firstName1} ${firstName2}`=='febina stephane'"> üò§ => ü§úüèΩü§ì</span>
                        <span v-else>üíî</span>

                    </div>
                    <div class="vue-box" ng-vue :name="ngContacts[0].firstName+' '+ngContacts[0].lastName" >
                        {{name}}
                    </div>

                    <pre>{{ngContacts|json}}</pre>

                    <div class="vue-box" ng-vue ng-vue-expose="ngMessage,&alert">
                        ng-vue-expose warning
                    </div>
                </div>
        </div>
    </div>

    <style>
        .ng-box::before  {
            content: 'AngularJs';
        }
        .vue-box::before  {
            content: 'Vue';
        }
        .ng-box::before, .vue-box::before  {
            display: block;
            font-size: 200%;
            font-weight: bold;
        }

        .ng-box  {
            border:solid 3px red;
        }
        .vue-box  {
            border:solid 3px green;
        }

        .ng-box, .vue-box {
            padding: 5px; 
            margin: 5px;
        }
    </style>

    <script type="module">

        import * as Vue from 'vue'    
        import { 
            registerPlugin,
            createNgVue,
            createAuth,
            createRouter,
            createRoute, 
            NgVueDirective 
        }     from '../dist/esm/index.js'     

        const ngApp = angular.module("app",['ngRoute'])

        ngApp.directive('ngVue',  NgVueDirective)

        ngApp.config(["$routeProvider", "$locationProvider", function ($routeProvider, $locationProvider) {
            $routeProvider.when('/', {});
            $routeProvider.when('/updated', {});
            $routeProvider.when('/updated/:count', {});
        }]);

        ngApp.run(['$injector', ($injector) => {

            const ngVue = createNgVue({ $injector, ngApp });

            registerPlugin(ngVue);
            registerPlugin(createAuth({ }));
            registerPlugin(createRouter({ plugins: { ngVue } }));
            registerPlugin(createRoute( { plugins: { ngVue } }));
        }]);

        var testVue3 = {
            template:`<div><button @click="trigger(internalMsg)">Send Alert!</button><input v-model="internalMsg">(vue 3)</div>`,
            props: {
                modelValue: String
            },
            computed: {
                internalMsg : {
                    get()  { return this.modelValue },
                    set(v) { this.$emit(`update:modelValue`, v) }
                }
            },
            methods:{
                trigger(v){ this.$emit('message', v)}
            }
        }
        
        ngApp.controller('MyNgController', function($scope){

            $scope.components = { testVue3 };
            
            $scope.vueVersion = Vue.version;
            $scope.clickCount = 0;

            $scope.ngContacts = [{
                firstName: 'stephane',
                lastName: 'bilodeau'
            },{
                firstName: 'blaise',
                lastName: 'fonseca'
            }]

            $scope.ngMessage = "Test";

            $scope.reset = function() {
                $scope.ngMessage = "Hello!";
            };

            $scope.alert = function(msg) {
                alert(`${msg}`);
            }

            $scope.reset();
        });


        angular.bootstrap(document, [ngApp.name]);    

    </script>
  </body>
</html>